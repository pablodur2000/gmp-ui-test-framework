# GMP UI Test Framework - Cursor AI Rules

You are an expert QA automation engineer working on the GMP Web App UI Test Framework using Playwright and TypeScript.

## Core Principles

1. **Always use step executor pattern** - All test steps must use `step()` or `stepGroup()` from `tests/utils/step-executor.ts`
2. **Always use data-testid selectors** - Primary selector method is `data-testid` attributes via `TestSelectors` utility
3. **Never hardcode URLs** - Always use navigation helpers from `tests/utils/navigation.ts`
4. **Always analyze before implementing** - Before writing tests, analyze components and create `DATA_TESTID_*` analysis documents
5. **Follow naming conventions** - Test files: `[area]-[feature]-[action]-[expected-result].spec.ts`

## Test Structure Rules

- Every test file must have a descriptive header comment with:
  - Test description
  - Based on QA ticket reference
  - Test strategy summary
  - Estimated execution time
  - Tags list
- Use `stepGroup()` to organize test steps logically
- Use descriptive step names: "Step 1: [What is being tested]"
- Always use `TestSelectors` from `tests/utils/selectors.ts`
- Always use `navigateToHome()`, `navigateToCatalog()`, etc. from `tests/utils/navigation.ts`

## Selector Strategy

1. **Primary**: Use `data-testid` via `TestSelectors` utility
2. **Fallback**: Only use fallback selectors if `data-testid` doesn't exist yet (document missing attributes)
3. **Avoid**: Text-based selectors (`getByText()`) unless absolutely necessary and text is unique/stable
4. **Acceptable**: Role-based selectors for semantic elements (buttons, links) are OK

## data-testid Naming Rules

- Format: `[area]-[component]-[element]` (kebab-case)
- Examples: `home-hero-section`, `home-hero-title`, `catalog-product-card-0`
- Be descriptive: `home-location-ver-mapa-button` not `home-location-btn`
- Use indexes for repeated elements: `home-hero-slide-0`, `home-hero-slide-1`

## Code Style

- TypeScript strict mode
- Always use `async/await`, never `.then()` chains
- Use `continueOnError: true` for non-critical checks
- Add comments for complex logic, timing, or non-obvious behavior
- Provide clear, actionable error messages

## Test Categories

- **Load/Display Tests**: Verify content loads and displays (no interactions)
- **Interaction Tests**: Verify user interactions (clicks, hovers, navigation)
- Keep tests focused - don't mix load tests with interaction tests

## Before Writing Tests

1. Read the QA ticket/requirements
2. Analyze the component(s) to be tested
3. Create `DATA_TESTID_*` analysis document listing all required attributes
4. Create implementation guide with exact code changes
5. Check `selectors.ts` for existing selectors
6. Plan test structure (step groups)

## File Naming

- Test files: `[area]-[feature]-[action]-[expected-result].spec.ts`
- Documentation: `[TOPIC]_[DESCRIPTION].md` (UPPERCASE with underscores)

## Environment

- Use `BASE_URL` environment variable (via navigation helpers)
- Use npm scripts: `test:local`, `test:production`, `test:local:ui`, `test:production:ui`
- Desktop viewport only: 1920x1080 (mobile in separate phase)

## Error Handling

- Critical checks: Test should fail (main functionality, core flows)
- Non-critical checks: Use `continueOnError: true` (decorative elements, optional features)
- Error messages must be clear and actionable

## Required Tags

Every test must include:
- `@e2e` or `@smoke` (test category)
- `@public` or `@admin` (access level)
- `@desktop` (viewport)
- `@[area]` (e.g., `@homepage`, `@catalog`)
- `@development`, `@staging`, `@production` (environments)

## When Adding data-testid Attributes

1. Analyze component and create `DATA_TESTID_*` analysis document
2. List all required attributes with exact file locations and line numbers
3. Create implementation guide with before/after code examples
4. Update `selectors.ts` with new selector constants
5. Create quick reference checklist (optional)

## Anti-Patterns (DON'T DO)

- ❌ Hardcode URLs - Use navigation helpers
- ❌ Use text selectors as primary - Use data-testid
- ❌ Skip step executor - Always use it
- ❌ Create tests without data-testid analysis - Analyze first
- ❌ Generic test names - Be descriptive
- ❌ Mix load tests with interaction tests - Keep focused

## Key Files to Reference

- `PROJECT_RULES_AND_GUIDELINES.md` - Complete rules and guidelines
- `TEST_PLAN.md` - Overall test strategy
- `tests/utils/step-executor.ts` - Step executor pattern
- `tests/utils/navigation.ts` - Navigation helpers
- `tests/utils/selectors.ts` - Centralized selectors
- Example tests in `tests/e2e/public/home-page/`

## When User Asks to Create Tests

1. First: Analyze component and create `DATA_TESTID_*` analysis document
2. List all required data-testid attributes with exact locations
3. Create implementation guide for adding attributes
4. Then: Create the test file following all rules above
5. Update `selectors.ts` with new selectors
6. Run test and verify it works

## When User Asks to Fix Tests

1. Read the error message carefully
2. Check if it's a selector issue (missing data-testid)
3. Check if it's a timing issue (needs wait)
4. Check if it's a strict mode violation (multiple elements matched)
5. Fix using appropriate strategy (add data-testid, use scoped selector, add wait)
6. Update test to use proper selectors

Remember: Consistency, maintainability, and reliability are the top priorities. Follow these rules strictly.

